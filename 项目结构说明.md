# 选矿生产管理系统 - 项目结构说明

本文档说明整理后的工程目录结构，便于区分前端、后端、脚本与数据文件。

---

## 一、整体结构概览

```
kuangshan_new/
├── src/                 # 前端源码（React + Vite + TypeScript）
├── server/              # 后端服务（Express + Prisma + MySQL）
├── python/              # Python 脚本（分析、导入、测试等）
├── data/                # 数据与资源文件
│   └── excel/           # Excel 相关文件
├── public/              # 前端静态资源
├── 项目结构说明.md      # 本说明文档
├── README.md
├── package.json         # 前端依赖与脚本
├── vite.config.ts
├── tailwind.config.js
└── ...
```

---

## 二、目录说明

### 1. `src/` — 前端

| 路径 | 说明 |
|------|------|
| `src/` | 前端应用根目录 |
| `src/App.tsx` | 应用入口与路由 |
| `src/main.tsx` | React 挂载入口 |
| `src/pages/` | 页面组件：登录、数据录入、金属平衡表、日报/月报、数据分析等 |
| `src/components/` | 公共组件：Layout、ProtectedRoute、Empty、ui 等 |
| `src/api/client.ts` | 前端 API 请求封装 |
| `src/contexts/` | React 上下文（如 AuthContext） |
| `src/hooks/`、`src/lib/` | 自定义 Hooks 与工具函数 |

**运行前端**：在项目根目录执行 `pnpm run dev`（使用根目录 `package.json`）。

---

### 2. `server/` — 后端

| 路径 | 说明 |
|------|------|
| `server/index.ts` | Express 主入口：鉴权、报表 API、化验单解析、金属平衡等 |
| `server/prisma/` | Prisma 模型与迁移（数据库 schema） |
| `server/scripts/` | 后端脚本（如 seed-admin.ts 初始化管理员） |
| `server/.env` | 后端环境变量（数据库、JWT 等） |
| `server/check_*.cjs`、`fix_*.cjs` 等 | 历史数据检查/修复脚本（按需使用） |

**运行后端**：进入 `server/` 目录后执行 `npx ts-node index.ts` 或使用其 `package.json` 中定义的脚本。

---

### 3. `python/` — Python 脚本

所有与 Python 相关的脚本已统一放在 `python/` 目录下，便于查找和维护。

| 文件 | 说明（按文件名推断，具体以脚本内注释为准） |
|------|------------------------------------------|
| `analyze_8aug.py` | 8 月相关数据分析 |
| `analyze_accounting.py` | 核算相关分析 |
| `import_accounting.py` | 核算数据导入 |
| `import_august.py` | 8 月数据导入 |
| `models.py` | 数据模型或公共定义 |
| `workshop_model.py` | 车间/工段相关模型 |
| `_analyze_excel_tmp.py` | Excel 临时分析脚本 |
| `_analyze_sheet2.py` | 第二 sheet 分析 |
| `_check_yiban.py` | 班次相关检查 |
| `_test_db_v2.py` | 数据库测试（v2） |

以 `_` 开头的文件一般为临时或辅助脚本。脚本内已按整理后的目录使用 `data/excel/` 下的路径（相对项目根目录），从项目根目录执行即可，例如：`python python/import_accounting.py`。运行前请确认已安装所需 Python 依赖（如 pandas、openpyxl）。

---

### 4. `data/excel/` — Excel 文件

所有 Excel 相关文件已归入 `data/excel/`，并按用途分子目录存放。

| 路径 | 说明 |
|------|------|
| `data/excel/templates/` | **模板文件**，如：<br>• `9.1.2CF(鸿晟)选矿台班样化验单.xlsx` — 化验单上传模板 |
| `data/excel/日报样本/` | **日报样本**，如：<br>• `完成生产日报表2025.06.28.xlsx` |
| `data/excel/CF鸿晟报表/` | **CF 鸿晟报表**，按月份/日期分子目录：<br>• `7月/` — 7 月核算等<br>• `8月/` — 8 月核算等<br>• `2026年1月/` — 2026 年 1 月核算等 |

前端「上传化验单」功能使用的格式需与 `templates/` 中模板一致；具体解析逻辑见 `server/index.ts` 中的化验单解析接口。

---

### 5. 其他根目录文件

| 文件/目录 | 说明 |
|-----------|------|
| `public/` | 前端静态资源（如 favicon） |
| `index.html` | 前端入口 HTML |
| `package.json`、`pnpm-lock.yaml` | 前端依赖（Vite、React 等） |
| `vite.config.ts`、`tailwind.config.js`、`tsconfig.json` 等 | 前端构建与类型配置 |
| `fix_db_permissions.sh` | 数据库权限等运维脚本（按需使用） |

---

## 三、使用与开发提示

1. **前端**：根目录 `pnpm install` 后 `pnpm run dev`。
2. **后端**：`server/` 下安装依赖并配置 `.env` 后启动 `index.ts`；数据库迁移使用 Prisma（`server/prisma/`）。
3. **Python**：在 `python/` 下执行脚本时，注意工作目录或脚本内路径是否需指向 `data/excel/` 等目录。
4. **Excel 模板**：新增或更新模板时，建议放在 `data/excel/templates/`，并在本说明或 README 中注明用途。

如需对某类脚本或数据再做细分，可在 `python/` 或 `data/excel/` 下继续建子目录，并在此文档中补充说明。
